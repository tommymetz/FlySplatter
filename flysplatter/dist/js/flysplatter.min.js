var debug=!1,iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,score=0,Flies=function(t,a){for(this.count=t||1,this.flies=new Array(t),this.id=a.id||"fly",this.assetlocation=a.assetlocation||".",this.containerid=a.containerid||"body",this.startpause=a.startpause||5e3,this.mute=a.mute||!1,this.score=a.score||!1,i=0;i<this.flies.length;i++)this.flies[i]=new Fly({id:this.id+i,assetlocation:this.assetlocation,containerid:this.containerid,startpause:this.startpause,mute:this.mute,score:this.score});this.score&&(this.scoreboard=document.createElement("div"),this.scoreboard.id="scoreboard",this.scoreboard.style.position="absolute",this.scoreboard.style.size="16px",this.scoreboard.style.color="#fff",this.scoreboard.style.padding="10px",this.scoreboard.style.backgroundColor="#000000",this.scoreboard.innerHTML="Score: 0","body"!=this.containerid?document.getElementById(this.containerid).appendChild(this.scoreboard):document.body.appendChild(this.scoreboard)),iOS?"body"!=this.containerid?document.getElementById(this.containerid).addEventListener("touchstart",function(t){trackEvent("pageclick","click")},!1):document.body.addEventListener("touchstart",function(t){trackEvent("pageclick","click")},!1):"body"!=this.containerid?document.getElementById(this.containerid).addEventListener("mousedown",function(t){trackEvent("pageclick","click")},!1):document.body.addEventListener("mousedown",function(t){trackEvent("pageclick","click")},!1)},Fly=function(t){if(this.id=t.id||"fly",this.assetlocation=t.assetlocation||".",this.containerid=t.containerid,this.startpause=t.startpause||5e3,this.mute=t.mute||!1,this.score=t.score||!1,this.interval=null,this.nextactionmaxcount=5,this.currentnextaction=0,this.splattered=!1,debug&&(this.target=document.createElement("div"),this.target.id=t.id+"-target",this.target.style.position="absolute",this.target.style.width="5px",this.target.style.height="5px",this.target.style.backgroundColor="#000000","body"!=this.containerid?document.getElementById(this.containerid).appendChild(this.target):document.body.appendChild(this.target)),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.id=t.id,this.canvas.style.position="absolute",this.canvas.style.zIndex=1e4,this.canvas.style.cursor="pointer",this.canvas.width=100,this.canvas.height=100,this.devicePixelRatio=window.devicePixelRatio||1,this.backingStoreRatio=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1,this.ratio=this.devicePixelRatio/this.backingStoreRatio,this.devicePixelRatio!==this.backingStoreRatio){var a=this.canvas.width,i=this.canvas.height;this.canvas.width=a*this.ratio,this.canvas.height=i*this.ratio,this.canvas.style.width=a+"px",this.canvas.style.height=i+"px",this.context.scale(this.ratio,this.ratio)}switch(this.context.shadowColor="rgba(0,0,0,0.1)",this.context.shadowOffsetX=10,this.context.shadowOffsetY=10,this.context.shadowBlur=10,Math.floor(4*Math.random())){case 0:this.canvas.style.marginLeft="1px",this.canvas.style.marginTop="1px";break;case 1:this.canvas.style.marginLeft=window.innerWidth+"px",this.canvas.style.marginTop="0px";break;case 2:this.canvas.style.marginLeft=window.innerWidth+"px",this.canvas.style.marginTop=window.innerHeight+"px";break;case 3:this.canvas.style.marginLeft="0px",this.canvas.style.marginTop=window.innerHeight+"px"}"body"!=this.containerid?document.getElementById(this.containerid).appendChild(this.canvas):document.body.appendChild(this.canvas),this.flyaudio=document.createElement("audio"),this.flyaudio.id=t.id+"_flyaudio",this.flyaudio.innerHTML='<source src="'+this.assetlocation+'/dist/audio/fly.ogg" type="audio/ogg"><source src="'+this.assetlocation+'/dist/audio/fly.mp3" type="audio/mpeg">',"body"!=this.containerid?document.getElementById(this.containerid).appendChild(this.flyaudio):document.body.appendChild(this.flyaudio),this.flysplataudio=document.createElement("audio"),this.flysplataudio.id=t.id+"_flysplataudio",this.flysplataudio.innerHTML='<source src="'+this.assetlocation+'/dist/audio/splat.ogg" type="audio/ogg"><source src="'+this.assetlocation+'/dist/audio/splat.mp3" type="audio/mpeg">',"body"!=this.containerid?document.getElementById(this.containerid).appendChild(this.flysplataudio):document.body.appendChild(this.flysplataudio),this.flyimg=new Image,this.flysplatimg=new Image,this.flyaudiomp3=new Audio,this.flyaudioogg=new Audio,this.flysplatmp3=new Audio,this.flysplatogg=new Audio,this.preloadfilescount=6,this.preloadcount=0;var e=this;docReady(function(){e.flyimg.src=e.assetlocation+"/dist/img/fly.png",e.flyimg.onload=e.preloaded(),e.flysplatimg.src=e.assetlocation+"/dist/img/flysplat.png",e.flysplatimg.onload=e.preloaded(),e.flyaudiomp3.src=e.assetlocation+"/dist/audio/fly.mp3",e.flyaudiomp3.addEventListener("canplaythrough",e.preloaded(),!1),e.flyaudioogg.src=e.assetlocation+"/dist/audio/fly.ogg",e.flyaudioogg.addEventListener("canplaythrough",e.preloaded(),!1),e.flysplatmp3.src=e.assetlocation+"/dist/audio/splat.mp3",e.flysplatmp3.addEventListener("canplaythrough",e.preloaded(),!1),e.flysplatogg.src=e.assetlocation+"/dist/audio/splat.ogg",e.flysplatogg.addEventListener("canplaythrough",e.preloaded(),!1)})};function trackEvent(t,a){}Fly.prototype.preloaded=function(){if(this.preloadcount++,this.preloadcount>=this.preloadfilescount){var t=this;setTimeout(function(){t.flyIn()},Math.floor(1e3*Math.random())+this.startpause)}},Fly.prototype.drawFly=function(t,a){var i=50,e=60;switch(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.save(),this.context.translate(this.canvas.width*(.5/this.ratio),this.canvas.width*(.5/this.ratio)),this.context.rotate(a),this.context.translate(-this.canvas.width*(.5/this.ratio),-this.canvas.width*(.5/this.ratio)),t){case"flying":this.context.drawImage(this.flyimg,0,0,i,e,this.canvas.width*(.25/this.ratio),this.canvas.height*(.25/this.ratio),i,e);break;case"normal":this.context.drawImage(this.flyimg,50,0,i,e,this.canvas.width*(.25/this.ratio),this.canvas.height*(.25/this.ratio),i,e);break;case"wing-twitch-left":this.context.drawImage(this.flyimg,100,0,i,e,this.canvas.width*(.25/this.ratio),this.canvas.height*(.25/this.ratio),i,e);break;case"wing-twitch-right":this.context.drawImage(this.flyimg,150,0,i,e,this.canvas.width*(.25/this.ratio),this.canvas.height*(.25/this.ratio),i,e);break;case"rubbing-arms-left":this.context.drawImage(this.flyimg,200,0,i,e,this.canvas.width*(.25/this.ratio),this.canvas.height*(.25/this.ratio),i,e);break;case"rubbing-arms-right":this.context.drawImage(this.flyimg,250,0,i,e,this.canvas.width*(.25/this.ratio),this.canvas.height*(.25/this.ratio),i,e)}this.context.restore()},Fly.prototype.flyIn=function(){this.splattered=!1,this.flyaudio.volume=0,!1===this.mute&&this.flyaudio.play();var t=this;t.fadeinterval=setInterval(function(){t.flyaudio.volume<.25?t.flyaudio.volume+=.02:clearInterval(t.fadeinterval)},20),this.targetx=Math.floor(Math.random()*(.75*window.innerWidth)+.125*window.innerWidth),this.targety=Math.floor(Math.random()*(.75*window.innerHeight)),debug&&(this.target.style.marginLeft=this.targetx+"px",this.target.style.marginTop=this.targety+"px",console.log("target: "+this.targetx+" x "+this.targety)),this.angle=Math.atan2(this.targety-parseInt(this.canvas.style.marginTop,10),this.targetx-parseInt(this.canvas.style.marginLeft,10))+Math.PI/2,this.drawFly("flying",this.angle),t.interval=setInterval(function(){var a=document.getElementById(t.id),i=t.targetx-parseInt(a.style.marginLeft,10),e=t.targety-parseInt(a.style.marginTop,10);a.style.marginLeft=parseInt(a.style.marginLeft,10)+.25*i+"px",a.style.marginTop=parseInt(a.style.marginTop,10)+.25*e+"px",Math.abs(i)<10&&(t.drawFly("normal",t.angle),clearInterval(t.interval),t.flyaudio.pause(),t.landed())},20)},Fly.prototype.landed=function(){var t=this;iOS?this.canvas.addEventListener("touchstart",function(a){t.splat()},!1):this.canvas.addEventListener("mousedown",function(a){t.splat()},!1),this.nextaction()},Fly.prototype.nextaction=function(){if(this.currentnextaction<this.nextactionmaxcount-1){var t=Math.floor(3*Math.random()),a=this;setTimeout(function(){switch(t){case 0:a.rubhands();break;case 1:a.wingstwitch();break;case 2:a.walkforward()}},Math.round(200*Math.random())+200),this.currentnextaction++}else this.currentnextaction=0,this.flyaway()},Fly.prototype.actiondone=function(){if(!this.splattered){var t=this;t.drawFly("normal",t.angle),setTimeout(t.nextaction(),Math.round(50*Math.random())+50)}},Fly.prototype.rubhands=function(){var t=Math.round(10*Math.random())+10,a=0,i=!1;!function e(s){this.splattered||(i?(i=!1,s.drawFly("rubbing-arms-left",s.angle)):(i=!0,s.drawFly("rubbing-arms-right",s.angle)),setTimeout(function(){a<t-1?(a++,e(s)):s.actiondone()},Math.round(50*Math.random())+50))}(this)},Fly.prototype.wingstwitch=function(){var t=Math.round(3*Math.random())+3,a=0,i=!1;!function e(s){this.splattered||(i?(i=!1,s.drawFly("wing-twitch-left",s.angle)):(i=!0,s.drawFly("wing-twitch-right",s.angle)),setTimeout(function(){a<t-1?(a++,e(s)):s.actiondone()},Math.round(70*Math.random())+30))}(this)},Fly.prototype.walkforward=function(){var t=Math.round(4*Math.random())+2,a=0,i=document.getElementById(this.id);!function e(s){if(!this.splattered){s.newangle=s.angle+(Math.round(90*Math.random())-45)*(Math.PI/180);var n=Math.round(40*Math.random())+20,o=Math.cos(s.newangle-Math.PI/2)*n,h=Math.sin(s.newangle-Math.PI/2)*n;s.newposx=parseInt(i.style.marginLeft,10)+o,s.newposy=parseInt(i.style.marginTop,10)+h,s.angle=s.newangle,s.drawFly("normal",s.newangle),i.style.marginLeft=s.newposx+"px",i.style.marginTop=s.newposy+"px",setTimeout(function(){a<t-1?(a++,e(s)):s.actiondone()},Math.round(50*Math.random())+50)}}(this)},Fly.prototype.flyaway=function(){document.onmousemove=null,this.flyaudio.volume=0,!1===this.mute&&this.flyaudio.play();var t=this;t.fadeinterval=setInterval(function(){t.flyaudio.volume<.25?t.flyaudio.volume+=.02:clearInterval(t.fadeinterval)},20);var a=document.getElementById(t.id);t.drawFly("flying",t.angle),t.interval=setInterval(function(){if(!this.splattered){var i=50*Math.cos(t.angle-Math.PI/2),e=50*Math.sin(t.angle-Math.PI/2);t.newposx=parseInt(a.style.marginLeft,10)+i,t.newposy=parseInt(a.style.marginTop,10)+e,a.style.marginLeft=t.newposx+"px",a.style.marginTop=t.newposy+"px",(parseInt(a.style.marginLeft,10)<=-200||parseInt(a.style.marginLeft,10)>=window.innerWidth||parseInt(a.style.marginTop,10)<=-200||parseInt(a.style.marginTop,10)>=window.innerHeight)&&(clearInterval(t.interval),t.flyaudio.pause(),setTimeout(function(){t.flyIn()},Math.round(1e3*Math.random())+t.startpause))}},10)},Fly.prototype.splat=function(){if(!this.splattered){if(this.splattered=!0,this.canvas.style.display="none",this.canvas_splat=document.createElement("canvas"),this.context_splat=this.canvas_splat.getContext("2d"),this.canvas_splat.id=this.id+"-splat-"+Math.round(1e4*Math.random()),this.canvas_splat.style.position="absolute",this.canvas_splat.style.zIndex=900,this.canvas_splat.width=200,this.canvas_splat.height=200,this.canvas_splat.style.marginLeft=parseInt(this.canvas.style.marginLeft,10)-50+"px",this.canvas_splat.style.marginTop=parseInt(this.canvas.style.marginTop,10)-50+"px",this.devicePixelRatio!==this.backingStoreRatio){var t=this.canvas_splat.width,a=this.canvas_splat.height;this.canvas_splat.width=t*this.ratio,this.canvas_splat.height=a*this.ratio,this.canvas_splat.style.width=t+"px",this.canvas_splat.style.height=a+"px",this.context_splat.scale(this.ratio,this.ratio)}"body"!=this.containerid?document.getElementById(this.containerid).appendChild(this.canvas_splat):document.body.appendChild(this.canvas_splat),this.drawSplatFly(),!1===this.mute&&this.flysplataudio.play();var i=this;setTimeout(function(){i.canvas.remove(),setTimeout(function(){new Fly({id:i.id,assetlocation:i.assetlocation,containerid:i.containerid,startpause:i.startpause,mute:i.mute,score:i.score})},Math.round(1e3*Math.random())+i.startpause)},1e3),this.score&&(document.getElementById("scoreboard").innerHTML="Score: "+(score+1),score++),trackEvent("splat","splat")}},Fly.prototype.drawSplatFly=function(){var t=Math.floor(5*Math.random());this.context_splat.clearRect(0,0,this.canvas_splat.width,this.canvas_splat.height),this.context_splat.save(),this.context_splat.translate(this.canvas_splat.width*(.5/this.ratio),this.canvas_splat.width*(.5/this.ratio)),this.context_splat.rotate(this.angle),this.context_splat.translate(-this.canvas_splat.width*(.5/this.ratio),-this.canvas_splat.width*(.5/this.ratio)),this.context_splat.drawImage(this.flysplatimg,100*t,0,100,100,this.canvas_splat.width*(.25/this.ratio),this.canvas_splat.height*(.25/this.ratio),100,100),this.context_splat.restore()},function(t,a){t=t||"docReady",a=a||window;var i=[],e=!1,s=!1;function n(){if(!e){e=!0;for(var t=0;t<i.length;t++)i[t].fn.call(window,i[t].ctx);i=[]}}function o(){"complete"===document.readyState&&n()}a[t]=function(t,a){e?setTimeout(function(){t(a)},1):(i.push({fn:t,ctx:a}),"complete"===document.readyState?setTimeout(n,1):s||(document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):(document.attachEvent("onreadystatechange",o),window.attachEvent("onload",n)),s=!0))}}("docReady",window);