function trackEvent(a,b){}var debug=!1,iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,score=0,Flies=function(a,b){for(this.count=a||1,this.flies=new Array(a),this.id=b.id||"fly",this.assetlocation=b.assetlocation||".",this.containerid=b.containerid||"body",this.startpause=b.startpause||5e3,this.mute=b.mute||!1,this.score=b.score||!1,i=0;i<this.flies.length;i++)this.flies[i]=new Fly({id:this.id+i,assetlocation:this.assetlocation,containerid:this.containerid,startpause:this.startpause,mute:this.mute,score:this.score});this.score&&(this.scoreboard=document.createElement("div"),this.scoreboard.id="scoreboard",this.scoreboard.style.position="absolute",this.scoreboard.style.size="16px",this.scoreboard.style.color="#fff",this.scoreboard.style.padding="10px",this.scoreboard.style.backgroundColor="#000000",this.scoreboard.innerHTML="Score: 0","body"!=this.containerid?document.getElementById(this.containerid).appendChild(this.scoreboard):document.body.appendChild(this.scoreboard)),iOS?"body"!=this.containerid?document.getElementById(this.containerid).addEventListener("touchstart",function(a){trackEvent("pageclick","click")},!1):document.body.addEventListener("touchstart",function(a){trackEvent("pageclick","click")},!1):"body"!=this.containerid?document.getElementById(this.containerid).addEventListener("mousedown",function(a){trackEvent("pageclick","click")},!1):document.body.addEventListener("mousedown",function(a){trackEvent("pageclick","click")},!1)},Fly=function(a){if(this.id=a.id||"fly",this.assetlocation=a.assetlocation||".",this.containerid=a.containerid,this.startpause=a.startpause||5e3,this.mute=a.mute||!1,this.score=a.score||!1,this.interval=null,this.nextactionmaxcount=5,this.currentnextaction=0,this.splattered=!1,debug&&(this.target=document.createElement("div"),this.target.id=a.id+"-target",this.target.style.position="absolute",this.target.style.width="5px",this.target.style.height="5px",this.target.style.backgroundColor="#000000","body"!=this.containerid?document.getElementById(this.containerid).appendChild(this.target):document.body.appendChild(this.target)),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.id=a.id,this.canvas.style.position="absolute",this.canvas.style.zIndex=1e4,this.canvas.style.cursor="pointer",this.canvas.width=100,this.canvas.height=100,this.devicePixelRatio=window.devicePixelRatio||1,this.backingStoreRatio=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1,this.ratio=this.devicePixelRatio/this.backingStoreRatio,this.devicePixelRatio!==this.backingStoreRatio){var b=this.canvas.width,c=this.canvas.height;this.canvas.width=b*this.ratio,this.canvas.height=c*this.ratio,this.canvas.style.width=b+"px",this.canvas.style.height=c+"px",this.context.scale(this.ratio,this.ratio)}this.context.shadowColor="rgba(0,0,0,0.1)",this.context.shadowOffsetX=10,this.context.shadowOffsetY=10,this.context.shadowBlur=10;var d=Math.floor(4*Math.random());switch(d){case 0:this.canvas.style.marginLeft="1px",this.canvas.style.marginTop="1px";break;case 1:this.canvas.style.marginLeft=window.innerWidth+"px",this.canvas.style.marginTop="0px";break;case 2:this.canvas.style.marginLeft=window.innerWidth+"px",this.canvas.style.marginTop=window.innerHeight+"px";break;case 3:this.canvas.style.marginLeft="0px",this.canvas.style.marginTop=window.innerHeight+"px"}"body"!=this.containerid?document.getElementById(this.containerid).appendChild(this.canvas):document.body.appendChild(this.canvas),this.flyaudio=document.createElement("audio"),this.flyaudio.id=a.id+"_flyaudio",this.flyaudio.innerHTML='<source src="'+this.assetlocation+'/dist/audio/fly.ogg" type="audio/ogg"><source src="'+this.assetlocation+'/dist/audio/fly.mp3" type="audio/mpeg">',"body"!=this.containerid?document.getElementById(this.containerid).appendChild(this.flyaudio):document.body.appendChild(this.flyaudio),this.flysplataudio=document.createElement("audio"),this.flysplataudio.id=a.id+"_flysplataudio",this.flysplataudio.innerHTML='<source src="'+this.assetlocation+'/dist/audio/splat.ogg" type="audio/ogg"><source src="'+this.assetlocation+'/dist/audio/splat.mp3" type="audio/mpeg">',"body"!=this.containerid?document.getElementById(this.containerid).appendChild(this.flysplataudio):document.body.appendChild(this.flysplataudio),this.flyimg=new Image,this.flysplatimg=new Image,this.flyaudiomp3=new Audio,this.flyaudioogg=new Audio,this.flysplatmp3=new Audio,this.flysplatogg=new Audio,this.preloadfilescount=6,this.preloadcount=0;var e=this;docReady(function(){e.flyimg.src=e.assetlocation+"/dist/img/fly.png",e.flyimg.onload=e.preloaded(),e.flysplatimg.src=e.assetlocation+"/dist/img/flysplat.png",e.flysplatimg.onload=e.preloaded(),e.flyaudiomp3.src=e.assetlocation+"/dist/audio/fly.mp3",e.flyaudiomp3.addEventListener("canplaythrough",e.preloaded(),!1),e.flyaudioogg.src=e.assetlocation+"/dist/audio/fly.ogg",e.flyaudioogg.addEventListener("canplaythrough",e.preloaded(),!1),e.flysplatmp3.src=e.assetlocation+"/dist/audio/splat.mp3",e.flysplatmp3.addEventListener("canplaythrough",e.preloaded(),!1),e.flysplatogg.src=e.assetlocation+"/dist/audio/splat.ogg",e.flysplatogg.addEventListener("canplaythrough",e.preloaded(),!1)})};Fly.prototype.preloaded=function(){if(this.preloadcount++,this.preloadcount>=this.preloadfilescount){var a=this;setTimeout(function(){a.flyIn()},Math.floor(1e3*Math.random())+this.startpause)}},Fly.prototype.drawFly=function(a,b){var c=50,d=60;switch(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.save(),this.context.translate(this.canvas.width*(.5/this.ratio),this.canvas.width*(.5/this.ratio)),this.context.rotate(b),this.context.translate(-this.canvas.width*(.5/this.ratio),-this.canvas.width*(.5/this.ratio)),a){case"flying":this.context.drawImage(this.flyimg,0*c,0,c,d,this.canvas.width*(.25/this.ratio),this.canvas.height*(.25/this.ratio),c,d);break;case"normal":this.context.drawImage(this.flyimg,1*c,0,c,d,this.canvas.width*(.25/this.ratio),this.canvas.height*(.25/this.ratio),c,d);break;case"wing-twitch-left":this.context.drawImage(this.flyimg,2*c,0,c,d,this.canvas.width*(.25/this.ratio),this.canvas.height*(.25/this.ratio),c,d);break;case"wing-twitch-right":this.context.drawImage(this.flyimg,3*c,0,c,d,this.canvas.width*(.25/this.ratio),this.canvas.height*(.25/this.ratio),c,d);break;case"rubbing-arms-left":this.context.drawImage(this.flyimg,4*c,0,c,d,this.canvas.width*(.25/this.ratio),this.canvas.height*(.25/this.ratio),c,d);break;case"rubbing-arms-right":this.context.drawImage(this.flyimg,5*c,0,c,d,this.canvas.width*(.25/this.ratio),this.canvas.height*(.25/this.ratio),c,d)}this.context.restore()},Fly.prototype.flyIn=function(){this.splattered=!1,this.flyaudio.volume=0,this.mute===!1&&this.flyaudio.play();var a=this;a.fadeinterval=setInterval(function(){a.flyaudio.volume<.25?a.flyaudio.volume+=.02:clearInterval(a.fadeinterval)},20),this.targetx=Math.floor(Math.random()*(.75*window.innerWidth)+.125*window.innerWidth),this.targety=Math.floor(Math.random()*(.75*window.innerHeight)),debug&&(this.target.style.marginLeft=this.targetx+"px",this.target.style.marginTop=this.targety+"px",console.log("target: "+this.targetx+" x "+this.targety)),this.angle=Math.atan2(this.targety-parseInt(this.canvas.style.marginTop,10),this.targetx-parseInt(this.canvas.style.marginLeft,10))+Math.PI/2,this.drawFly("flying",this.angle),a.interval=setInterval(function(){var b=document.getElementById(a.id),c=a.targetx-parseInt(b.style.marginLeft,10),d=a.targety-parseInt(b.style.marginTop,10);b.style.marginLeft=parseInt(b.style.marginLeft,10)+.25*c+"px",b.style.marginTop=parseInt(b.style.marginTop,10)+.25*d+"px",Math.abs(c)<10&&(a.drawFly("normal",a.angle),clearInterval(a.interval),a.flyaudio.pause(),a.landed())},20)},Fly.prototype.landed=function(){var a=this;iOS?this.canvas.addEventListener("touchstart",function(b){a.splat()},!1):this.canvas.addEventListener("mousedown",function(b){a.splat()},!1),this.nextaction()},Fly.prototype.nextaction=function(){if(this.currentnextaction<this.nextactionmaxcount-1){var a=Math.floor(3*Math.random()),b=this;setTimeout(function(){switch(a){case 0:b.rubhands();break;case 1:b.wingstwitch();break;case 2:b.walkforward()}},Math.round(200*Math.random())+200),this.currentnextaction++}else this.currentnextaction=0,this.flyaway()},Fly.prototype.actiondone=function(){if(!this.splattered){var a=this;a.drawFly("normal",a.angle),setTimeout(a.nextaction(),Math.round(50*Math.random())+50)}},Fly.prototype.rubhands=function(){function a(e){this.splattered||(d?(d=!1,e.drawFly("rubbing-arms-left",e.angle)):(d=!0,e.drawFly("rubbing-arms-right",e.angle)),setTimeout(function(){b-1>c?(c++,a(e)):e.actiondone()},Math.round(50*Math.random())+50))}var b=Math.round(10*Math.random())+10,c=0,d=!1,e=this;a(e)},Fly.prototype.wingstwitch=function(){function a(e){this.splattered||(d?(d=!1,e.drawFly("wing-twitch-left",e.angle)):(d=!0,e.drawFly("wing-twitch-right",e.angle)),setTimeout(function(){b-1>c?(c++,a(e)):e.actiondone()},Math.round(70*Math.random())+30))}var b=Math.round(3*Math.random())+3,c=0,d=!1,e=this;a(e)},Fly.prototype.walkforward=function(){function a(d){if(!this.splattered){d.newangle=d.angle+(Math.round(90*Math.random())-45)*(Math.PI/180);var f=Math.round(40*Math.random())+20,g=Math.cos(d.newangle-Math.PI/2)*f,h=Math.sin(d.newangle-Math.PI/2)*f;d.newposx=parseInt(e.style.marginLeft,10)+g,d.newposy=parseInt(e.style.marginTop,10)+h,d.angle=d.newangle,d.drawFly("normal",d.newangle),e.style.marginLeft=d.newposx+"px",e.style.marginTop=d.newposy+"px",setTimeout(function(){b-1>c?(c++,a(d)):d.actiondone()},Math.round(50*Math.random())+50)}}var b=Math.round(4*Math.random())+2,c=0,d=this,e=document.getElementById(d.id);a(d)},Fly.prototype.flyaway=function(){document.onmousemove=null,this.flyaudio.volume=0,this.mute===!1&&this.flyaudio.play();var a=this;a.fadeinterval=setInterval(function(){a.flyaudio.volume<.25?a.flyaudio.volume+=.02:clearInterval(a.fadeinterval)},20);var b=document.getElementById(a.id);a.drawFly("flying",a.angle),a.interval=setInterval(function(){if(!this.splattered){var c=50*Math.cos(a.angle-Math.PI/2),d=50*Math.sin(a.angle-Math.PI/2);a.newposx=parseInt(b.style.marginLeft,10)+c,a.newposy=parseInt(b.style.marginTop,10)+d,b.style.marginLeft=a.newposx+"px",b.style.marginTop=a.newposy+"px",(parseInt(b.style.marginLeft,10)<=-200||parseInt(b.style.marginLeft,10)>=window.innerWidth||parseInt(b.style.marginTop,10)<=-200||parseInt(b.style.marginTop,10)>=window.innerHeight)&&(clearInterval(a.interval),a.flyaudio.pause(),setTimeout(function(){a.flyIn()},Math.round(1e3*Math.random())+a.startpause))}},10)},Fly.prototype.splat=function(){if(!this.splattered){if(this.splattered=!0,this.canvas.style.display="none",this.canvas_splat=document.createElement("canvas"),this.context_splat=this.canvas_splat.getContext("2d"),this.canvas_splat.id=this.id+"-splat-"+Math.round(1e4*Math.random()),this.canvas_splat.style.position="absolute",this.canvas_splat.style.zIndex=900,this.canvas_splat.width=200,this.canvas_splat.height=200,this.canvas_splat.style.marginLeft=parseInt(this.canvas.style.marginLeft,10)-50+"px",this.canvas_splat.style.marginTop=parseInt(this.canvas.style.marginTop,10)-50+"px",this.devicePixelRatio!==this.backingStoreRatio){var a=this.canvas_splat.width,b=this.canvas_splat.height;this.canvas_splat.width=a*this.ratio,this.canvas_splat.height=b*this.ratio,this.canvas_splat.style.width=a+"px",this.canvas_splat.style.height=b+"px",this.context_splat.scale(this.ratio,this.ratio)}"body"!=this.containerid?document.getElementById(this.containerid).appendChild(this.canvas_splat):document.body.appendChild(this.canvas_splat),this.drawSplatFly(),this.mute===!1&&this.flysplataudio.play();var c=this;setTimeout(function(){c.canvas.remove(),setTimeout(function(){new Fly({id:c.id,assetlocation:c.assetlocation,containerid:c.containerid,startpause:c.startpause,mute:c.mute,score:c.score})},Math.round(1e3*Math.random())+c.startpause)},1e3),this.score&&(document.getElementById("scoreboard").innerHTML="Score: "+(score+1),score++),trackEvent("splat","splat")}},Fly.prototype.drawSplatFly=function(){var a=100,b=100,c=5,d=Math.floor(Math.random()*c);this.context_splat.clearRect(0,0,this.canvas_splat.width,this.canvas_splat.height),this.context_splat.save(),this.context_splat.translate(this.canvas_splat.width*(.5/this.ratio),this.canvas_splat.width*(.5/this.ratio)),this.context_splat.rotate(this.angle),this.context_splat.translate(-this.canvas_splat.width*(.5/this.ratio),-this.canvas_splat.width*(.5/this.ratio)),this.context_splat.drawImage(this.flysplatimg,a*d,0,a,b,this.canvas_splat.width*(.25/this.ratio),this.canvas_splat.height*(.25/this.ratio),a,b),this.context_splat.restore()},function(a,b){function c(){if(!f){f=!0;for(var a=0;a<e.length;a++)e[a].fn.call(window,e[a].ctx);e=[]}}function d(){"complete"===document.readyState&&c()}a=a||"docReady",b=b||window;var e=[],f=!1,g=!1;b[a]=function(a,b){return f?void setTimeout(function(){a(b)},1):(e.push({fn:a,ctx:b}),void("complete"===document.readyState?setTimeout(c,1):g||(document.addEventListener?(document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1)):(document.attachEvent("onreadystatechange",d),window.attachEvent("onload",c)),g=!0)))}}("docReady",window);